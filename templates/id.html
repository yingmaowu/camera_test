{% extends "base.html" %}
{% block title %}輸入病患 ID{% endblock %}
{% block content %}
<div class="card">
  <h1>輸入病患 ID</h1>
  <p class="muted">為了正確歸檔與查詢，請先輸入病患 ID。</p>

  <form id="idForm" class="flex-col" style="margin-top:8px">
    <input class="input" id="idInput" name="patient" placeholder="例如：Test001" required inputmode="text" autocomplete="off">
    <button class="btn" type="submit">繼續</button>
  </form>

  <div class="sticky-actions">
    <a class="btn btn-outline" href="{{ url_for('home') }}">返回首頁</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const nextPage = urlParams.get("next") || "index";

  document.getElementById("idForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const id = document.getElementById("idInput").value.trim();
    if(!id){ return Swal.fire("⚠️ 請輸入病患 ID"); }
    const dest = (nextPage === "history")
      ? `{{ url_for('history') }}?patient=${encodeURIComponent(id)}`
      : `{{ url_for('index') }}?patient=${encodeURIComponent(id)}`;
    window.location.href = dest;
  });
</script>
{% endblock %}
