{% extends "base.html" %}
{% block title %}輸入病患 ID{% endblock %}
{% block content %}
<div class="card">
  <h1>輸入病患 ID</h1>
  <p class="muted">請輸入病患 ID 以便紀錄與查詢。</p>

  <form id="idForm" class="grid grid-2" style="margin-top:12px">
    <input class="input" id="idInput" name="patient" placeholder="例如：Test001" required>
    <button class="btn" type="submit">進入</button>
  </form>

  <div class="sticky-actions center" style="margin-top:16px">
    <a class="btn btn-outline" href="{{ url_for('home') }}">返回首頁</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // 從查詢參數取得 next（預設 index）
  const urlParams = new URLSearchParams(window.location.search);
  const nextPage = urlParams.get("next") || "index";

  document.getElementById("idForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const id = document.getElementById("idInput").value.trim();
    if(!id){
      return Swal.fire("⚠️ 請輸入病患 ID");
    }
    const dest = (nextPage === "history")
      ? `/history?patient=${encodeURIComponent(id)}`
      : `/index?patient=${encodeURIComponent(id)}`;
    window.location.href = dest;
  });
</script>
{% endblock %}
