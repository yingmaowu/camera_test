<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>舌象分類教學</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: "Segoe UI", "Noto Sans TC", sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      background: #f8fafc;
    }
    h2 { margin: 0 0 12px; }
    p.hint { margin: 0 0 16px; color:#555; font-size: 0.95rem; }
    .color-button {
      margin: 5px;
      padding: 10px 12px;
      border-radius: 6px;
      border: 2px solid #ccc;
      cursor: pointer;
      min-width: 64px;
      background: #fff;
    }
    .toolbar {
      display:flex; justify-content:center; flex-wrap:wrap; gap:8px; margin-bottom:12px;
    }
    svg#tongueMap {
      width: 100%;
      max-width: 420px;
      height: auto;
      display: block;
      margin: 12px auto 8px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    #confirm-btn, #clear-btn {
      margin: 8px;
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      font-size: 0.95rem;
      background: #2563eb;
      color: #fff;
      cursor: pointer;
    }
    #clear-btn { background: #64748b; }
    #result {
      max-width: 520px;
      margin: 10px auto 0;
      padding: 12px 14px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
      text-align:left;
      line-height:1.6;
      font-size: 0.98rem;
      min-height: 48px;
    }
  </style>
</head>
<body>
  <h2>舌象分類教學</h2>
  <p class="hint">請先點選舌頭部位，再選擇舌苔顏色，按「確認」查看教學說明。</p>

  <!-- 顏色按鈕 -->
  <div class="toolbar">
    <button class="color-button" onclick="selectColor('white')" style="background:white;">白色</button>
    <button class="color-button" onclick="selectColor('yellow')" style="background:gold;">黃色</button>
    <button class="color-button" onclick="selectColor('black')" style="background:black; color:white;">黑色</button>
    <button class="color-button" onclick="selectColor('red')" style="background:red; color:white;">紅色</button>
  </div>

  <!-- 舌頭圖片與互動區塊（使用教學靜態圖） -->
  <svg id="tongueMap" viewBox="0 0 1024 1536" preserveAspectRatio="xMidYMid meet" aria-label="舌頭示意圖互動地圖">
    <image href="{{ url_for('static', filename='teaching/tongue-diagram.jpg') }}"
      x="0" y="0" width="1024" height="1536" />

    <!-- 可點選區塊（若未對齊，可依實際圖片調整 x/y/width/height） -->
    <g id="regionGroup" fill-opacity="0.4">
      <rect id="腎"   x="380" y="100"  width="200" height="100" fill="transparent" stroke="gray" stroke-width="2" />
      <rect id="肝"   x="180" y="450"  width="180" height="150" fill="transparent" stroke="gray" stroke-width="2" />
      <rect id="膽"   x="660" y="450"  width="180" height="150" fill="transparent" stroke="gray" stroke-width="2" />
      <rect id="脾胃" x="400" y="750"  width="200" height="150" fill="transparent" stroke="gray" stroke-width="2" />
      <rect id="心肺" x="420" y="1050" width="180" height="150" fill="transparent" stroke="gray" stroke-width="2" />
    </g>
  </svg>

  <div>
    <button id="clear-btn"  onclick="clearSelection()">清除</button>
    <button id="confirm-btn" onclick="showResult()">確認</button>
    <button onclick="history.back()" style="margin:8px; padding:10px 15px; border:none; border-radius:6px;">上一頁</button>
  </div>

  <!-- 結果顯示區 -->
  <div id="result" role="status" aria-live="polite"></div>

  <script>
    let selectedRegion = null;
    let selectedColor = null;

    // 點選區塊選部位
    document.querySelectorAll('#regionGroup rect').forEach(rect => {
      rect.addEventListener('click', () => {
        selectedRegion = rect.id;
        highlightRegion();
      });
    });

    function selectColor(color) {
      selectedColor = color;
      highlightRegion();
    }

    function highlightRegion() {
      document.querySelectorAll('#regionGroup rect').forEach(rect => {
        if (rect.id === selectedRegion && selectedColor) {
          rect.setAttribute('fill', selectedColor);
        } else {
          rect.setAttribute('fill', 'transparent');
        }
      });
    }

    function clearSelection() {
      selectedRegion = null;
      selectedColor  = null;
      document.getElementById('result').innerHTML = '';
      document.querySelectorAll('#regionGroup rect').forEach(rect => rect.setAttribute('fill', 'transparent'));
    }

    // 展示結果（目前示例資料，可日後擴充成外部 JSON/JS 檔）
    function showResult() {
      const resultBox = document.getElementById('result');
      if (!selectedRegion || !selectedColor) {
        resultBox.innerHTML = '<p>請先選擇部位與顏色。</p>';
        return;
      }
      const key = `${selectedRegion}_${selectedColor}`;
      const data = {
        '腎_white':  { message:'腎陽虛，腰痠怕冷。', herb:'中藥建議：附子、杜仲。', classic:'—' },
        '脾胃_yellow': { message:'脾胃濕熱，口苦納呆。', herb:'中藥建議：黃連、茯苓。', classic:'—' },
        '心肺_red': { message:'心火旺盛，舌紅煩躁。', herb:'中藥建議：蓮子心、丹參。', classic:'—' }
      };
      if (data[key]) {
        resultBox.innerHTML = `
          <p><strong>選擇部位：</strong>${selectedRegion}</p>
          <p><strong>選擇顏色：</strong>${selectedColor}</p>
          <p><strong>分析結果：</strong>${data[key].message}</p>
          <p>${data[key].herb}</p>
          <p><em>${data[key].classic}</em></p>
        `;
      } else {
        resultBox.innerHTML = `<p>此組合尚未設定：${selectedRegion} + ${selectedColor}</p>`;
      }
    }
  </script>
</body>
</html>
