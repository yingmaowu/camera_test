<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>{% block title %}舌苔系統{% endblock %}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    .dropdown{position:relative}
    .dropdown-menu{
      position:absolute; right:0; top:calc(100% + 6px); min-width:220px; background:#fff; border:1px solid #e5e7eb;
      border-radius:12px; box-shadow:var(--shadow); padding:6px; display:none; z-index:100;
    }
    .dropdown.open .dropdown-menu{display:block}
    .dropdown-item{display:block; padding:12px; border-radius:10px; text-decoration:none; color:var(--text)}
    .dropdown-item:hover{background:#f5f7fb}
    .split-button{display:flex; gap:6px}
    .caret-btn{width:48px; min-width:48px}
  </style>
</head>
<body>
  <header class="nav">
    <button class="btn btn-ghost" onclick="history.back()" aria-label="上一頁" style="width:auto">←</button>
    <a class="nav__brand" href="{{ url_for('home') }}">舌苔辨識與教學</a>

    <div class="nav__right" id="navRight">
      <a class="btn" href="{{ url_for('id_input', next='index') }}">舌苔辨識</a>
      <a class="btn" href="{{ url_for('id_input', next='history') }}">歷史紀錄</a>

      <!-- 教學資源：改為可點的主按鈕 + caret 下拉 -->
      <div class="dropdown" id="teachingDropdown">
        <div class="split-button">
          <a class="btn btn-outline" href="{{ url_for('teaching') }}">教學資源</a>
          <button class="btn btn-outline caret-btn" type="button" id="teachingCaret" aria-haspopup="true" aria-expanded="false">▾</button>
        </div>
        <div class="dropdown-menu" role="menu" aria-label="教學選單">
          <a class="dropdown-item" href="{{ url_for('tongue_teaching_static') }}">舌象分類教學</a>
          <a class="dropdown-item" href="{{ url_for('quiz') }}">舌象判別練習</a>
          <a class="dropdown-item" href="/practice/">中醫五區辨識練習</a>
          <a class="dropdown-item" href="{{ url_for('tongue_quiz') }}">舌頭知識問答</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="footer">
    <div>© {{ 2025 }} 幸福吳家</div>
    <div class="footer__links">
      <a href="{{ url_for('home') }}">首頁</a>
      <a href="{{ url_for('teaching') }}">教學資源</a>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/ui.js') }}"></script>
  <script>
    // 只在點「▾」時開關下拉；點「教學資源」會直接去 /teaching
    (function(){
      const dd = document.getElementById('teachingDropdown');
      const caret = document.getElementById('teachingCaret');
      caret.addEventListener('click', (e)=>{
        e.stopPropagation();
        const open = dd.classList.toggle('open');
        caret.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
      document.addEventListener('click', (e)=>{
        if (!dd.contains(e.target)) { dd.classList.remove('open'); caret.setAttribute('aria-expanded','false'); }
      });
      document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape'){ dd.classList.remove('open'); caret.setAttribute('aria-expanded','false'); } });
    })();
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
